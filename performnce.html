<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ØªÙ‚ÙŠÙŠÙ… ÙˆØ¬Ø¨Ø§Øª Ø±Ù…Ø¶Ø§Ù†</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #0a0a0f;
      --surface: #111118;
      --surface2: #1a1a26;
      --border: rgba(255,255,255,0.07);
      --border2: rgba(255,255,255,0.12);
      --gold: #c9a84c;
      --gold2: #e8c97a;
      --rose: #c0666a;
      --teal: #4a9e9e;
      --text: #e8e4d9;
      --muted: #6e6a60;
      --ex: #5dba7e;
      --good: #5d9eba;
      --avg: #c9a84c;
      --bad: #c0666a;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Tajawal', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ====== BACKGROUND ====== */
    .bg-art {
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      overflow: hidden;
    }
    .bg-art::before {
      content: '';
      position: absolute;
      width: 900px; height: 900px;
      top: -300px; right: -200px;
      background: radial-gradient(circle, rgba(201,168,76,0.06) 0%, transparent 70%);
      border-radius: 50%;
    }
    .bg-art::after {
      content: '';
      position: absolute;
      width: 600px; height: 600px;
      bottom: -100px; left: -150px;
      background: radial-gradient(circle, rgba(74,158,158,0.07) 0%, transparent 70%);
      border-radius: 50%;
    }

    /* Geometric Islamic pattern overlay */
    .pattern-overlay {
      position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c9a84c' fill-opacity='1'%3E%3Cpath d='M30 0l8.66 15H21.34L30 0zm0 60l-8.66-15h17.32L30 60zM0 30l15-8.66V38.66L0 30zm60 0l-15 8.66V21.34L60 30z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    /* ====== LAYOUT ====== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 20px;
      position: relative;
      z-index: 1;
    }

    /* ====== HEADER ====== */
    .site-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 28px 36px;
      margin-bottom: 28px;
      background: linear-gradient(135deg, rgba(17,17,24,0.95), rgba(26,26,38,0.95));
      border: 1px solid var(--border2);
      border-radius: 20px;
      backdrop-filter: blur(20px);
      position: relative;
      overflow: hidden;
    }
    .site-header::before {
      content: '';
      position: absolute;
      top: 0; right: 0;
      width: 200px; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(201,168,76,0.05));
    }
    .header-left {}
    .header-title {
      font-family: 'Amiri', serif;
      font-size: 26px;
      font-weight: 700;
      color: var(--gold2);
      line-height: 1.2;
    }
    .header-sub {
      font-size: 13px;
      color: var(--muted);
      margin-top: 4px;
      font-weight: 400;
    }
    .header-emblem {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .crescent {
      font-size: 48px;
      line-height: 1;
      filter: drop-shadow(0 0 20px rgba(201,168,76,0.5));
      animation: float 4s ease-in-out infinite;
    }
    @keyframes float {
      0%,100% { transform: translateY(0px); }
      50% { transform: translateY(-6px); }
    }
    .ramadan-text {
      font-family: 'Amiri', serif;
      font-size: 13px;
      color: var(--gold);
      letter-spacing: 1px;
    }

    /* ====== TABS ====== */
    .tabs-wrapper {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 6px;
    }
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      font-family: 'Tajawal', sans-serif;
      font-weight: 700;
      font-size: 15px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .tab-btn.active {
      background: linear-gradient(135deg, rgba(201,168,76,0.15), rgba(201,168,76,0.08));
      color: var(--gold2);
      border: 1px solid rgba(201,168,76,0.25);
    }
    .tab-icon { font-size: 18px; }

    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

    /* ====== CARDS ====== */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 24px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }
    .card-title {
      font-family: 'Amiri', serif;
      font-size: 18px;
      color: var(--gold);
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card-title-icon {
      width: 32px; height: 32px;
      background: rgba(201,168,76,0.12);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
    }

    /* ====== FORM FIELDS ====== */
    .fields-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    .field-group { display: flex; flex-direction: column; gap: 7px; }
    .field-label {
      font-size: 12px;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .field-input {
      background: var(--surface2);
      border: 1px solid var(--border2);
      border-radius: 10px;
      padding: 11px 14px;
      color: var(--text);
      font-family: 'Tajawal', sans-serif;
      font-size: 14px;
      font-weight: 500;
      outline: none;
      transition: border-color 0.2s;
    }
    .field-input:focus { border-color: rgba(201,168,76,0.4); }
    .field-input option { background: #1a1a26; }

    /* ====== RATING STARS â€” INNOVATIVE ====== */
    .criteria-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media(max-width:640px) { .criteria-grid { grid-template-columns: 1fr; } }

    .criterion-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      transition: border-color 0.3s;
    }
    .criterion-card.has-value { border-color: rgba(201,168,76,0.3); }

    .criterion-label {
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .criterion-num {
      width: 22px; height: 22px;
      background: rgba(201,168,76,0.15);
      color: var(--gold);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; font-weight: 900;
    }

    /* Emoji-style rating buttons */
    .rating-options {
      display: flex;
      gap: 8px;
    }
    .rating-opt {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      padding: 10px 6px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.02);
      cursor: pointer;
      transition: all 0.25s;
      position: relative;
    }
    .rating-opt:hover { border-color: var(--border2); transform: translateY(-2px); }
    .rating-opt .opt-emoji { font-size: 22px; transition: transform 0.2s; }
    .rating-opt .opt-label {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      white-space: nowrap;
    }

    .rating-opt[data-val="Ù…Ù…ØªØ§Ø²"].active { background: rgba(93,186,126,0.15); border-color: #5dba7e; }
    .rating-opt[data-val="Ù…Ù…ØªØ§Ø²"].active .opt-label { color: #5dba7e; }
    .rating-opt[data-val="Ù…Ù…ØªØ§Ø²"].active .opt-emoji { transform: scale(1.2); }

    .rating-opt[data-val="Ø¬ÙŠØ¯"].active { background: rgba(93,158,186,0.15); border-color: #5d9eba; }
    .rating-opt[data-val="Ø¬ÙŠØ¯"].active .opt-label { color: #5d9eba; }
    .rating-opt[data-val="Ø¬ÙŠØ¯"].active .opt-emoji { transform: scale(1.2); }

    .rating-opt[data-val="Ù…Ù‚Ø¨ÙˆÙ„"].active { background: rgba(201,168,76,0.15); border-color: var(--gold); }
    .rating-opt[data-val="Ù…Ù‚Ø¨ÙˆÙ„"].active .opt-label { color: var(--gold); }
    .rating-opt[data-val="Ù…Ù‚Ø¨ÙˆÙ„"].active .opt-emoji { transform: scale(1.2); }

    .rating-opt[data-val="Ø¶Ø¹ÙŠÙ"].active { background: rgba(192,102,106,0.15); border-color: var(--rose); }
    .rating-opt[data-val="Ø¶Ø¹ÙŠÙ"].active .opt-label { color: var(--rose); }
    .rating-opt[data-val="Ø¶Ø¹ÙŠÙ"].active .opt-emoji { transform: scale(1.2); }

    /* Checkmark badge */
    .criterion-check {
      display: none;
      width: 18px; height: 18px;
      background: var(--ex);
      border-radius: 50%;
      align-items: center; justify-content: center;
      font-size: 10px; color: white;
      margin-right: auto;
    }
    .criterion-card.has-value .criterion-check { display: flex; }

    /* ====== SCORE PREVIEW ====== */
    .score-preview {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px 20px;
      margin-bottom: 16px;
    }
    .score-label { font-size: 13px; color: var(--muted); font-weight: 600; }
    .score-value { font-family: 'Amiri', serif; font-size: 28px; color: var(--gold2); font-weight: 700; }
    .score-meter {
      flex: 1;
      margin: 0 20px;
      height: 8px;
      background: rgba(255,255,255,0.05);
      border-radius: 99px;
      overflow: hidden;
    }
    .score-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--rose), var(--avg), var(--ex));
      border-radius: 99px;
      transition: width 0.5s cubic-bezier(.4,0,.2,1);
      width: 0%;
    }

    /* ====== NOTES & SUBMIT ====== */
    textarea.field-input {
      min-height: 90px;
      resize: vertical;
      width: 100%;
    }
    .submit-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #b8860b, #c9a84c, #e8c97a);
      color: #0a0a0f;
      font-family: 'Tajawal', sans-serif;
      font-weight: 900;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      letter-spacing: 0.5px;
      margin-top: 14px;
      box-shadow: 0 8px 24px rgba(201,168,76,0.25);
    }
    .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(201,168,76,0.35); }
    .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

    /* ====== ANALYTICS ====== */
    /* Stats Bar */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    @media(max-width:700px) { .stats-row { grid-template-columns: repeat(2,1fr); } }

    .stat-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      transition: transform 0.2s;
    }
    .stat-card:hover { transform: translateY(-2px); }
    .stat-emoji { font-size: 24px; }
    .stat-num {
      font-family: 'Amiri', serif;
      font-size: 32px;
      font-weight: 700;
      line-height: 1;
    }
    .stat-card.total .stat-num { color: var(--gold2); }
    .stat-card.ex .stat-num { color: var(--ex); }
    .stat-card.good .stat-num { color: var(--good); }
    .stat-card.avg .stat-num { color: var(--avg); }
    .stat-card.bad .stat-num { color: var(--bad); }
    .stat-lbl { font-size: 12px; color: var(--muted); font-weight: 600; }

    /* Filters */
    .filters-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .filters-row .field-input { flex: 1; min-width: 160px; }

    /* Charts */
    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 20px;
    }
    @media(max-width:700px) { .charts-grid { grid-template-columns: 1fr; } }

    .chart-box {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
    }
    .chart-box.wide {
      grid-column: 1 / -1;
    }
    .chart-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--muted);
      margin-bottom: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Radar box */
    .radar-box {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Heat bar per category */
    .cat-bars { display: flex; flex-direction: column; gap: 10px; }
    .cat-row { display: flex; flex-direction: column; gap: 5px; }
    .cat-name { font-size: 12px; font-weight: 700; color: var(--muted); }
    .cat-bar-track {
      height: 28px;
      background: rgba(255,255,255,0.04);
      border-radius: 6px;
      display: flex;
      overflow: hidden;
      gap: 2px;
    }
    .cat-seg {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 800;
      color: rgba(0,0,0,0.7);
      transition: width 0.6s cubic-bezier(.4,0,.2,1);
      min-width: 0;
      overflow: hidden;
      white-space: nowrap;
    }
    .cat-seg.ex { background: var(--ex); border-radius: 4px 0 0 4px; }
    .cat-seg.good { background: var(--good); }
    .cat-seg.avg { background: var(--avg); }
    .cat-seg.bad { background: var(--bad); border-radius: 0 4px 4px 0; }

    /* Table */
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    thead th {
      background: rgba(201,168,76,0.08);
      color: var(--gold);
      padding: 12px 10px;
      font-size: 12px;
      font-weight: 700;
      border-bottom: 1px solid var(--border2);
      white-space: nowrap;
      text-align: right;
    }
    tbody td {
      padding: 11px 10px;
      font-size: 13px;
      color: var(--text);
      border-bottom: 1px solid var(--border);
    }
    tbody tr:hover { background: rgba(255,255,255,0.02); }
    .badge-val {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 800;
    }
    .badge-val.Ù…Ù…ØªØ§Ø² { background: rgba(93,186,126,0.15); color: var(--ex); border: 1px solid rgba(93,186,126,0.3); }
    .badge-val.Ø¬ÙŠØ¯ { background: rgba(93,158,186,0.15); color: var(--good); border: 1px solid rgba(93,158,186,0.3); }
    .badge-val.Ù…Ù‚Ø¨ÙˆÙ„ { background: rgba(201,168,76,0.15); color: var(--avg); border: 1px solid rgba(201,168,76,0.3); }
    .badge-val.Ø¶Ø¹ÙŠÙ { background: rgba(192,102,106,0.15); color: var(--bad); border: 1px solid rgba(192,102,106,0.3); }

    /* ====== TOAST ====== */
    .toast {
      position: fixed; bottom: 24px; left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: var(--surface2);
      border: 1px solid var(--border2);
      color: var(--text);
      padding: 13px 24px;
      border-radius: 14px;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.5);
      transition: transform 0.35s cubic-bezier(.4,0,.2,1);
      z-index: 999;
      white-space: nowrap;
    }
    .toast.show { transform: translateX(-50%) translateY(0); }
    .toast.success { border-color: rgba(93,186,126,0.4); }
    .toast.error { border-color: rgba(192,102,106,0.4); }
  </style>
</head>
<body>

<div class="bg-art"></div>
<div class="pattern-overlay"></div>

<div class="container">

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-left">
      <div class="header-title">Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚ÙŠÙŠÙ… ÙˆØ¬Ø¨Ø§Øª Ø±Ù…Ø¶Ø§Ù†</div>
      <div class="header-sub">ÙØ¶Ù„Ø§Ù‹ Ù‚Ù… Ø¨Ø§Ø³ØªÙŠÙØ§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¯Ø¹Ù… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø©</div>
    </div>
    <div class="header-emblem">
      <div class="crescent">ğŸŒ™</div>
      <div class="ramadan-text">Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</div>
    </div>
  </header>

  <!-- TABS -->
  <div class="tabs-wrapper">
    <button class="tab-btn active" data-tab="form">
      <span class="tab-icon">ğŸ“</span> ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    </button>
    <button class="tab-btn" data-tab="analytics">
      <span class="tab-icon">ğŸ“Š</span> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„
    </button>
  </div>

  <!-- ===================== FORM ===================== -->
  <div id="form" class="tab-content active">

    <!-- Basic Info -->
    <div class="card">
      <div class="card-title">
        <div class="card-title-icon">ğŸ“‹</div>
        Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
      </div>
      <div class="fields-grid">
<div class="field-group">
  <div class="field-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
  <input type="text" id="dateInput" class="field-input" readonly>
</div>
        <div class="field-group">
          <div class="field-label">Ø§Ù„ÙŠÙˆÙ…</div>
          <input type="text" id="dayLabel" class="field-input" readonly>
        </div>
        <div class="field-group">
          <div class="field-label">Ø§Ù„Ø§Ø³Ù…</div>
          <input type="text" id="nameInput" class="field-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
        </div>
        <div class="field-group">
          <div class="field-label">Ø§Ù„Ù‚Ø³Ù…</div>
          <select id="deptSelect" class="field-input">
            <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Ratings -->
    <div class="card">
      <div class="card-title">
        <div class="card-title-icon">â­</div>
        ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ¬Ø¨Ø©
      </div>

      <!-- Score Preview -->
      <div class="score-preview">
        <div>
          <div class="score-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙƒÙ„ÙŠ</div>
        </div>
        <div class="score-meter"><div class="score-fill" id="scoreFill"></div></div>
        <div class="score-value" id="scoreText">â€”</div>
      </div>

      <div class="criteria-grid">

        <div class="criterion-card" id="crit-quality">
          <div class="criterion-label">
            <div class="criterion-num">Ù¡</div>
            Ø¬ÙˆØ¯Ø© Ø§Ù„Ø·Ø¹Ø§Ù…
            <div class="criterion-check">âœ“</div>
          </div>
          <div class="rating-options" data-key="quality">
            <div class="rating-opt" data-val="Ù…Ù…ØªØ§Ø²"><div class="opt-emoji">ğŸ¤©</div><div class="opt-label">Ù…Ù…ØªØ§Ø²</div></div>
            <div class="rating-opt" data-val="Ø¬ÙŠØ¯"><div class="opt-emoji">ğŸ˜Š</div><div class="opt-label">Ø¬ÙŠØ¯</div></div>
            <div class="rating-opt" data-val="Ù…Ù‚Ø¨ÙˆÙ„"><div class="opt-emoji">ğŸ˜</div><div class="opt-label">Ù…Ù‚Ø¨ÙˆÙ„</div></div>
            <div class="rating-opt" data-val="Ø¶Ø¹ÙŠÙ"><div class="opt-emoji">ğŸ˜</div><div class="opt-label">Ø¶Ø¹ÙŠÙ</div></div>
          </div>
        </div>

        <div class="criterion-card" id="crit-taste">
          <div class="criterion-label">
            <div class="criterion-num">Ù¢</div>
            Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ°ÙˆÙ‚
            <div class="criterion-check">âœ“</div>
          </div>
          <div class="rating-options" data-key="taste">
            <div class="rating-opt" data-val="Ù…Ù…ØªØ§Ø²"><div class="opt-emoji">ğŸ˜‹</div><div class="opt-label">Ù…Ù…ØªØ§Ø²</div></div>
            <div class="rating-opt" data-val="Ø¬ÙŠØ¯"><div class="opt-emoji">ğŸ™‚</div><div class="opt-label">Ø¬ÙŠØ¯</div></div>
            <div class="rating-opt" data-val="Ù…Ù‚Ø¨ÙˆÙ„"><div class="opt-emoji">ğŸ˜‘</div><div class="opt-label">Ù…Ù‚Ø¨ÙˆÙ„</div></div>
            <div class="rating-opt" data-val="Ø¶Ø¹ÙŠÙ"><div class="opt-emoji">ğŸ¤¢</div><div class="opt-label">Ø¶Ø¹ÙŠÙ</div></div>
          </div>
        </div>

        <div class="criterion-card" id="crit-portions">
          <div class="criterion-label">
            <div class="criterion-num">Ù£</div>
            Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
            <div class="criterion-check">âœ“</div>
          </div>
          <div class="rating-options" data-key="portions">
            <div class="rating-opt" data-val="Ù…Ù…ØªØ§Ø²"><div class="opt-emoji">ğŸ½ï¸</div><div class="opt-label">Ù…Ù…ØªØ§Ø²</div></div>
            <div class="rating-opt" data-val="Ø¬ÙŠØ¯"><div class="opt-emoji">ğŸ¥˜</div><div class="opt-label">Ø¬ÙŠØ¯</div></div>
            <div class="rating-opt" data-val="Ù…Ù‚Ø¨ÙˆÙ„"><div class="opt-emoji">ğŸ¥—</div><div class="opt-label">Ù…Ù‚Ø¨ÙˆÙ„</div></div>
            <div class="rating-opt" data-val="Ø¶Ø¹ÙŠÙ"><div class="opt-emoji">ğŸœ</div><div class="opt-label">Ø¶Ø¹ÙŠÙ</div></div>
          </div>
        </div>

        <div class="criterion-card" id="crit-presentation">
          <div class="criterion-label">
            <div class="criterion-num">Ù¤</div>
            Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¹Ø§Ù…
            <div class="criterion-check">âœ“</div>
          </div>
          <div class="rating-options" data-key="presentation">
            <div class="rating-opt" data-val="Ù…Ù…ØªØ§Ø²"><div class="opt-emoji">âœ¨</div><div class="opt-label">Ù…Ù…ØªØ§Ø²</div></div>
            <div class="rating-opt" data-val="Ø¬ÙŠØ¯"><div class="opt-emoji">ğŸ‘Œ</div><div class="opt-label">Ø¬ÙŠØ¯</div></div>
            <div class="rating-opt" data-val="Ù…Ù‚Ø¨ÙˆÙ„"><div class="opt-emoji">ğŸ‘</div><div class="opt-label">Ù…Ù‚Ø¨ÙˆÙ„</div></div>
            <div class="rating-opt" data-val="Ø¶Ø¹ÙŠÙ"><div class="opt-emoji">ğŸ‘</div><div class="opt-label">Ø¶Ø¹ÙŠÙ</div></div>
          </div>
        </div>

      </div>
    </div>

    <!-- Notes & Submit -->
    <div class="card">
      <div class="card-title">
        <div class="card-title-icon">ğŸ’¬</div>
        Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© <span style="color:var(--muted);font-size:13px;font-weight:400;">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
      </div>
      <textarea id="notesInput" class="field-input" placeholder="Ø´Ø§Ø±ÙƒÙ†Ø§ Ø±Ø£ÙŠÙƒ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø©..."></textarea>
      <button class="submit-btn" id="submitBtn" onclick="submitForm()">
        ğŸ“© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
      </button>
    </div>

  </div>

  <!-- ===================== ANALYTICS ===================== -->
  <div id="analytics" class="tab-content">

    <!-- Stats -->
    <div class="stats-row">
      <div class="stat-card total">
        <div class="stat-emoji">ğŸ“Œ</div>
        <div class="stat-num" id="statTotal">0</div>
        <div class="stat-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>
      </div>
      <div class="stat-card ex">
        <div class="stat-emoji">ğŸŒŸ</div>
        <div class="stat-num" id="statEx">0</div>
        <div class="stat-lbl">Ù…Ù…ØªØ§Ø²</div>
      </div>
      <div class="stat-card good">
        <div class="stat-emoji">ğŸ‘</div>
        <div class="stat-num" id="statGood">0</div>
        <div class="stat-lbl">Ø¬ÙŠØ¯</div>
      </div>
      <div class="stat-card avg">
        <div class="stat-emoji">ğŸ‘Œ</div>
        <div class="stat-num" id="statAvg">0</div>
        <div class="stat-lbl">Ù…Ù‚Ø¨ÙˆÙ„</div>
      </div>
      <div class="stat-card bad">
        <div class="stat-emoji">âš ï¸</div>
        <div class="stat-num" id="statBad">0</div>
        <div class="stat-lbl">Ø¶Ø¹ÙŠÙ</div>
      </div>
    </div>

    <!-- Filters -->
    <div class="card">
      <div class="card-title">
        <div class="card-title-icon">ğŸ”</div>
        ÙÙ„Ø§ØªØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„
      </div>
      <div class="filters-row">
        <input type="date" id="analyticsDate" class="field-input" style="flex:0 0 180px">
        <select id="analyticsDept" class="field-input">
          <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
        </select>
        <input type="text" id="searchEval" class="field-input" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...">
      </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="charts-grid">

      <!-- Donut Chart -->
      <div class="chart-box">
        <div class="chart-title">ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„ÙƒÙ„ÙŠ</div>
        <select id="categorySelect" class="field-input" style="margin-bottom:14px;width:100%;font-size:13px;">
          <option value="quality">Ø¬ÙˆØ¯Ø© Ø§Ù„Ø·Ø¹Ø§Ù…</option>
          <option value="taste">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ°ÙˆÙ‚</option>
          <option value="portions">Ø§Ù„ÙƒÙ…ÙŠØ§Øª</option>
          <option value="presentation">Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¹Ø§Ù…</option>
        </select>
        <canvas id="donutChart" height="220"></canvas>
      </div>

      <!-- Category Breakdown Bars -->
      <div class="chart-box">
        <div class="chart-title">ğŸ“ˆ ØªØ­Ù„ÙŠÙ„ ÙƒÙ„ Ù…Ø¹ÙŠØ§Ø±</div>
        <div class="cat-bars" id="catBars">
          <div class="cat-row">
            <div class="cat-name">Ø¬ÙˆØ¯Ø© Ø§Ù„Ø·Ø¹Ø§Ù…</div>
            <div class="cat-bar-track">
              <div class="cat-seg ex" id="bar-quality-ex" style="width:0%"></div>
              <div class="cat-seg good" id="bar-quality-good" style="width:0%"></div>
              <div class="cat-seg avg" id="bar-quality-avg" style="width:0%"></div>
              <div class="cat-seg bad" id="bar-quality-bad" style="width:0%"></div>
            </div>
          </div>
          <div class="cat-row">
            <div class="cat-name">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ°ÙˆÙ‚</div>
            <div class="cat-bar-track">
              <div class="cat-seg ex" id="bar-taste-ex" style="width:0%"></div>
              <div class="cat-seg good" id="bar-taste-good" style="width:0%"></div>
              <div class="cat-seg avg" id="bar-taste-avg" style="width:0%"></div>
              <div class="cat-seg bad" id="bar-taste-bad" style="width:0%"></div>
            </div>
          </div>
          <div class="cat-row">
            <div class="cat-name">Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</div>
            <div class="cat-bar-track">
              <div class="cat-seg ex" id="bar-portions-ex" style="width:0%"></div>
              <div class="cat-seg good" id="bar-portions-good" style="width:0%"></div>
              <div class="cat-seg avg" id="bar-portions-avg" style="width:0%"></div>
              <div class="cat-seg bad" id="bar-portions-bad" style="width:0%"></div>
            </div>
          </div>
          <div class="cat-row">
            <div class="cat-name">Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¹Ø§Ù…</div>
            <div class="cat-bar-track">
              <div class="cat-seg ex" id="bar-presentation-ex" style="width:0%"></div>
              <div class="cat-seg good" id="bar-presentation-good" style="width:0%"></div>
              <div class="cat-seg avg" id="bar-presentation-avg" style="width:0%"></div>
              <div class="cat-seg bad" id="bar-presentation-bad" style="width:0%"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Line Chart -->
      <div class="chart-box wide">
        <div class="chart-title">ğŸ“… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£ÙŠØ§Ù…</div>
        <canvas id="lineChart" height="100"></canvas>
      </div>

    </div>

    <!-- Table -->
    <div class="card">
      <div class="card-title">
        <div class="card-title-icon">ğŸ—‚ï¸</div>
        Ø³Ø¬Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø§Ù„ÙŠÙˆÙ…</th>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„Ù‚Ø³Ù…</th>
              <th>Ø§Ù„Ø¬ÙˆØ¯Ø©</th>
              <th>Ø§Ù„ØªØ°ÙˆÙ‚</th>
              <th>Ø§Ù„ÙƒÙ…ÙŠØ§Øª</th>
              <th>Ø§Ù„Ù…Ø¸Ù‡Ø±</th>
              <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="resultsBody"></tbody>
        </table>
      </div>
    </div>

  </div>

</div>

<div id="toast" class="toast"></div>

<!-- ============================== JS ============================== -->
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwIUGNXTUBjdikikZkwXh6mIWhZ3CTz_CKraMa9do7WkcfTlN5pny8V9-VUBlssnskjYA/exec";

const DEPARTMENTS = [
  "Administration","Electrical & Instrumentation","Finished Products","HSE",
  "Mechanical Maintenance","Packing","Production","Quality","Vehicle Workshop",
  "Utilities","Supply Planning","Spare Parts W/H","Projects","Logistics","Export","Costing"
];

const SCORE_MAP = { Ù…Ù…ØªØ§Ø²:4, Ø¬ÙŠØ¯:3, Ù…Ù‚Ø¨ÙˆÙ„:2, Ø¶Ø¹ÙŠÙ:1 };
const KEYS = ["quality","taste","portions","presentation"];

/* ===== TOAST ===== */
function showToast(msg, type="") {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.className = "toast " + type;
  setTimeout(() => t.classList.add("show"), 20);
  setTimeout(() => t.classList.remove("show"), 3500);
}

/* ===== TABS ===== */
document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    const tab = btn.dataset.tab;
    document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
    document.getElementById(tab).classList.add("active");
    if (tab === "analytics") loadAnalytics();
  });
});

/* ===== INIT FORM ===== */
function todayStr() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}
function dayNameAr(ds) {
  return new Date(ds).toLocaleDateString("ar-EG", { weekday:"long" });
}

(function initForm() {
  const sel = document.getElementById("deptSelect");
  sel.innerHTML = `<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>` +
    DEPARTMENTS.map(d => `<option>${d}</option>`).join("");

const dateEl = document.getElementById("dateInput");
dateEl.value = todayStr();
document.getElementById("dayLabel").value = dayNameAr(todayStr());


  // Fill analytics dept too
  const asel = document.getElementById("analyticsDept");
  asel.innerHTML = `<option value="">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>` +
    DEPARTMENTS.map(d => `<option>${d}</option>`).join("");

  // Rating buttons
  document.querySelectorAll(".rating-options").forEach(group => {
    group.querySelectorAll(".rating-opt").forEach(opt => {
      opt.addEventListener("click", () => {
        group.querySelectorAll(".rating-opt").forEach(o => o.classList.remove("active"));
        opt.classList.add("active");
        const key = group.dataset.key;
        const card = document.getElementById("crit-"+key);
        if (card) card.classList.add("has-value");
        updateScorePreview();
      });
    });
  });
})();

/* ===== SCORE PREVIEW ===== */
function updateScorePreview() {
  let total = 0, count = 0;
  KEYS.forEach(k => {
    const active = document.querySelector(`.rating-options[data-key="${k}"] .rating-opt.active`);
    if (active) { total += SCORE_MAP[active.dataset.val] || 0; count++; }
  });

  const fill = document.getElementById("scoreFill");
  const text = document.getElementById("scoreText");

  if (count === 0) { fill.style.width = "0%"; text.textContent = "â€”"; return; }

  const pct = ((total / (count * 4)) * 100).toFixed(0);
  fill.style.width = pct + "%";

  const avg = total / count;
  if (avg >= 3.5) text.textContent = "Ù…Ù…ØªØ§Ø² ğŸŒŸ";
  else if (avg >= 2.5) text.textContent = "Ø¬ÙŠØ¯ ğŸ‘";
  else if (avg >= 1.5) text.textContent = "Ù…Ù‚Ø¨ÙˆÙ„ ğŸ‘Œ";
  else text.textContent = "Ø¶Ø¹ÙŠÙ âš ï¸";
}

/* ===== GET RATINGS ===== */
function getRatings() {
  const r = {};
  KEYS.forEach(k => {
    const active = document.querySelector(`.rating-options[data-key="${k}"] .rating-opt.active`);
    r[k] = active ? active.dataset.val : "";
  });
  return r;
}

/* ===== VALIDATE ===== */
function validateForm(data) {
  const miss = [];
  if (!data.name) miss.push("Ø§Ù„Ø§Ø³Ù…");
  if (!data.department) miss.push("Ø§Ù„Ù‚Ø³Ù…");
  if (!data.ratings.quality) miss.push("Ø¬ÙˆØ¯Ø© Ø§Ù„Ø·Ø¹Ø§Ù…");
  if (!data.ratings.taste) miss.push("Ø§Ù„ØªØ°ÙˆÙ‚");
  if (!data.ratings.portions) miss.push("Ø§Ù„ÙƒÙ…ÙŠØ§Øª");
  if (!data.ratings.presentation) miss.push("Ø§Ù„Ù…Ø¸Ù‡Ø±");
  return miss;
}

/* ===== SUBMIT ===== */
async function submitForm() {
  const btn = document.getElementById("submitBtn");

  const payload = {
    date: document.getElementById("dateInput").value,
    day: document.getElementById("dayLabel").value,
    name: document.getElementById("nameInput").value.trim(),
    department: document.getElementById("deptSelect").value,
    ratings: getRatings(),
    notes: document.getElementById("notesInput").value.trim()
  };

  const miss = validateForm(payload);
  if (miss.length) { showToast("âš ï¸ Ø£ÙƒÙ…Ù„: " + miss.join("ØŒ ")); return; }

  btn.disabled = true; btn.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type":"application/x-www-form-urlencoded" },
      body: new URLSearchParams({ action:"save_performance", row:JSON.stringify(payload) })
    });
    const out = await res.json();
    if (!out.ok) throw new Error(out.message || "ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸");

    showToast("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­", "success");
    document.getElementById("nameInput").value = "";
    document.getElementById("deptSelect").value = "";
    document.getElementById("notesInput").value = "";
    document.querySelectorAll(".rating-opt").forEach(o => o.classList.remove("active"));
    document.querySelectorAll(".criterion-card").forEach(c => c.classList.remove("has-value"));
    updateScorePreview();

  } catch (err) {
    showToast("âŒ " + err.message, "error");
  }

  btn.disabled = false; btn.textContent = "ğŸ“© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…";
}

/* ===== ANALYTICS ===== */
let ALL_DATA = [];
let donutChart, lineChart;

async function loadAnalytics() {
  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type":"application/x-www-form-urlencoded" },
      body: "action=get_performance"
    });
    const out = await res.json();
    if (!out.ok) throw new Error(out.error);
    ALL_DATA = out.data || [];
    renderAnalytics();
  } catch (err) {
    showToast("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„", "error");
  }
}

function filterData() {
  const date = document.getElementById("analyticsDate").value;
  const dept = document.getElementById("analyticsDept").value;
  const search = document.getElementById("searchEval").value.trim().toLowerCase();

  return ALL_DATA.filter(r => {
    if (date && r.Date !== date) return false;
    if (dept && r.Department !== dept) return false;
    if (search) {
      const blob = (r.Name + " " + r["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]).toLowerCase();
      if (!blob.includes(search)) return false;
    }
    return true;
  });
}

function count(list, field) {
  const c = { Ù…Ù…ØªØ§Ø²:0, Ø¬ÙŠØ¯:0, Ù…Ù‚Ø¨ÙˆÙ„:0, Ø¶Ø¹ÙŠÙ:0 };
  list.forEach(r => { const v = r[field]; if (c[v] !== undefined) c[v]++; });
  return c;
}

const FIELD_MAP = {
  quality: "Ù…Ø³ØªÙˆÙ‰ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø·Ø¹Ø§Ù…",
  taste: "Ù…Ø³ØªÙˆÙ‰ ØªØ°ÙˆÙ‚ Ø§Ù„Ø·Ø¹Ø§Ù…",
  portions: "Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ù…Ø¹ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª",
  presentation: "Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¹Ø§Ù… Ù„Ù„ÙˆØ¬Ø¨Ø§Øª"
};

function renderAnalytics() {
  const list = filterData();

  // Stats
  const allVals = list.flatMap(r => KEYS.map(k => r[FIELD_MAP[k]]));
  const tot = { Ù…Ù…ØªØ§Ø²:0, Ø¬ÙŠØ¯:0, Ù…Ù‚Ø¨ÙˆÙ„:0, Ø¶Ø¹ÙŠÙ:0 };
  allVals.forEach(v => { if (tot[v] !== undefined) tot[v]++; });
  document.getElementById("statTotal").textContent = list.length;
  document.getElementById("statEx").textContent = tot.Ù…Ù…ØªØ§Ø²;
  document.getElementById("statGood").textContent = tot.Ø¬ÙŠØ¯;
  document.getElementById("statAvg").textContent = tot.Ù…Ù‚Ø¨ÙˆÙ„;
  document.getElementById("statBad").textContent = tot.Ø¶Ø¹ÙŠÙ;

  // Category bars
  KEYS.forEach(k => {
    const c = count(list, FIELD_MAP[k]);
    const total = list.length || 1;
    ["ex","good","avg","bad"].forEach((cls, i) => {
      const labels = ["Ù…Ù…ØªØ§Ø²","Ø¬ÙŠØ¯","Ù…Ù‚Ø¨ÙˆÙ„","Ø¶Ø¹ÙŠÙ"];
      const el = document.getElementById(`bar-${k}-${cls}`);
      if (el) {
        const pct = (c[labels[i]] / total * 100);
        el.style.width = pct + "%";
        el.textContent = pct > 8 ? Math.round(pct) + "%" : "";
      }
    });
  });

  // Donut
  const selField = FIELD_MAP[document.getElementById("categorySelect").value];
  const dc = count(list, selField);
  if (donutChart) donutChart.destroy();
  donutChart = new Chart(document.getElementById("donutChart"), {
    type: "doughnut",
    data: {
      labels: ["Ù…Ù…ØªØ§Ø²","Ø¬ÙŠØ¯","Ù…Ù‚Ø¨ÙˆÙ„","Ø¶Ø¹ÙŠÙ"],
      datasets: [{
        data: [dc.Ù…Ù…ØªØ§Ø², dc.Ø¬ÙŠØ¯, dc.Ù…Ù‚Ø¨ÙˆÙ„, dc.Ø¶Ø¹ÙŠÙ],
        backgroundColor: ["#5dba7e","#5d9eba","#c9a84c","#c0666a"],
        borderColor: "#111118",
        borderWidth: 3,
        hoverOffset: 6
      }]
    },
    options: {
      cutout: "65%",
      plugins: {
        legend: {
          position: "bottom",
          labels: { color: "#e8e4d9", font: { family:"Tajawal", size:12, weight:"700" }, padding:12 }
        }
      }
    }
  });

  // Line
  const byDate = {};
  list.forEach(r => { byDate[r.Date] = (byDate[r.Date]||0) + 1; });
  const sortedDates = Object.keys(byDate).sort();

  if (lineChart) lineChart.destroy();
  lineChart = new Chart(document.getElementById("lineChart"), {
    type: "line",
    data: {
      labels: sortedDates,
      datasets: [{
        label: "Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª",
        data: sortedDates.map(d => byDate[d]),
        borderColor: "#c9a84c",
        backgroundColor: "rgba(201,168,76,0.1)",
        tension: 0.4,
        fill: true,
        pointBackgroundColor: "#c9a84c",
        pointRadius: 5,
        pointHoverRadius: 7
      }]
    },
    options: {
      scales: {
        x: { ticks: { color:"#6e6a60", font:{family:"Tajawal"} }, grid: { color:"rgba(255,255,255,0.04)" } },
        y: { ticks: { color:"#6e6a60", font:{family:"Tajawal"} }, grid: { color:"rgba(255,255,255,0.04)" }, beginAtZero: true }
      },
      plugins: { legend: { labels: { color:"#e8e4d9", font:{family:"Tajawal",weight:"700"} } } }
    }
  });

  // Table
  const body = document.getElementById("resultsBody");
  body.innerHTML = "";
  list.forEach((r, i) => {
    const vals = KEYS.map(k => `<td><span class="badge-val ${r[FIELD_MAP[k]]}">${r[FIELD_MAP[k]]||"â€”"}</span></td>`).join("");
    body.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${r.Date||""}</td>
        <td>${r.Day||""}</td>
        <td>${r.Name||""}</td>
        <td>${r.Department||""}</td>
        ${vals}
        <td style="max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${r["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]||""}">${r["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]||"â€”"}</td>
      </tr>`;
  });
}

document.querySelectorAll("#analyticsDate,#analyticsDept,#categorySelect").forEach(el =>
  el.addEventListener("change", renderAnalytics)
);
document.getElementById("searchEval").addEventListener("input", renderAnalytics);
</script>
</body>
</html>
